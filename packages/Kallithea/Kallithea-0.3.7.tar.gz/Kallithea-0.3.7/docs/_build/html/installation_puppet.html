
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Installation and setup using Puppet &#8212; Kallithea 0.3.7 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="General Kallithea usage" href="usage/general.html" />
    <link rel="prev" title="Setup" href="setup.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usage/general.html" title="General Kallithea usage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="setup.html" title="Setup"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Kallithea 0.3.7 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installation-and-setup-using-puppet">
<span id="installation-puppet"></span><h1>Installation and setup using Puppet<a class="headerlink" href="#installation-and-setup-using-puppet" title="Permalink to this headline">¶</a></h1>
<p>The whole installation and setup process of Kallithea can be simplified by
using Puppet and the <a class="reference external" href="https://forge.puppetlabs.com/rauch/kallithea">rauch/kallithea</a> Puppet module. This is
especially useful for getting started quickly, without having to deal with all
the Python specialities.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following instructions assume you are not familiar with Puppet at
all. If this is not the case, you should probably skip directly to the
<a class="reference external" href="https://forge.puppetlabs.com/rauch/kallithea#puppet-kallithea">Kallithea Puppet module documentation</a>.</p>
</div>
<div class="section" id="installing-puppet">
<h2>Installing Puppet<a class="headerlink" href="#installing-puppet" title="Permalink to this headline">¶</a></h2>
<p>This installation variant requires a Unix/Linux type server with Puppet 3.0+
installed. Many major distributions have Puppet in their standard repositories.
Thus, you will probably be ready to go by running, e.g. <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">install</span>
<span class="pre">puppet</span></code> or <code class="docutils literal notranslate"><span class="pre">yum</span> <span class="pre">install</span> <span class="pre">puppet</span></code>, depending on your distro’s favoured package
manager. Afterwards, check the Puppet version by running <code class="docutils literal notranslate"><span class="pre">puppet</span> <span class="pre">--version</span></code>
and ensure you have at least 3.0.</p>
<p>If your distribution does not provide Puppet packages or you need a
newer version, please see the <a class="reference external" href="https://docs.puppetlabs.com/puppet/4.2/reference/install_linux.html">Puppet Reference Manual</a> for
instructions on how to install Puppet on your target platform.</p>
</div>
<div class="section" id="installing-the-puppet-module">
<h2>Installing the Puppet module<a class="headerlink" href="#installing-the-puppet-module" title="Permalink to this headline">¶</a></h2>
<p>To install the latest version of the Kallithea Puppet module from the Puppet
Forge, run the following as <code class="docutils literal notranslate"><span class="pre">root</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>puppet module install rauch/kallithea
</pre></div>
</div>
<p>This will install both the Kallithea Puppet module and its dependency modules.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be aware that Puppet can do all kinds of things to your systems.
Third-party modules (like the <code class="docutils literal notranslate"><span class="pre">kallithea</span></code> module) may run
arbitrary commands on your system (most of the time as the
<code class="docutils literal notranslate"><span class="pre">root</span></code> user), so do not apply them on production machines if
you don’t know what you are doing. Instead, use a test system
(e.g. a virtual machine) for evaluation purposes.</p>
</div>
</div>
<div class="section" id="applying-the-module">
<h2>Applying the module<a class="headerlink" href="#applying-the-module" title="Permalink to this headline">¶</a></h2>
<p>To trigger the actual installation process, we have to <em>apply</em> the
<code class="docutils literal notranslate"><span class="pre">kallithea</span></code> Puppet class, which is provided by the module we have just
installed, to our system. For this, create a file named e.g. <code class="docutils literal notranslate"><span class="pre">kallithea.pp</span></code>,
a <em>Puppet manifest</em>, with the following content:</p>
<div class="highlight-puppet notranslate" id="simple-manifest"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="p">{</span> <span class="s">&#39;kallithea&#39;</span><span class="p">:</span>
  <span class="na">seed_db</span>    <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
  <span class="na">manage_git</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To apply the manifest, simply run the following (preferably as root):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>puppet apply kallithea.pp
</pre></div>
</div>
<p>This will basically run through the usual Kallithea <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Installation on Unix/Linux</span></a> and
<a class="reference internal" href="setup.html#setup"><span class="std std-ref">Setup</span></a> steps, as documented. Consult the module documentation for details
on <a class="reference external" href="https://forge.puppetlabs.com/rauch/kallithea#what-kallithea-affects">what the module affects</a>. You
can also do a <em>dry run</em> by adding the <code class="docutils literal notranslate"><span class="pre">--noop</span></code> option to the command.</p>
</div>
<div class="section" id="using-parameters-for-customizing-the-setup-process">
<h2>Using parameters for customizing the setup process<a class="headerlink" href="#using-parameters-for-customizing-the-setup-process" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">kallithea</span></code> Puppet class provides a number of <a class="reference external" href="https://forge.puppetlabs.com/rauch/kallithea#class-kallithea">parameters</a> for
customizing the setup process. You have seen the usage of the <code class="docutils literal notranslate"><span class="pre">seed_db</span></code>
parameter in the <a class="reference internal" href="#simple-manifest"><span class="std std-ref">example above</span></a>, but there are more.
For example, you can specify the installation directory, the name of the user
under which Kallithea gets installed, the initial admin password, etc.
Notably, you can provide arbitrary modifications to Kallitheas configuration
file by means of the <code class="docutils literal notranslate"><span class="pre">config_hash</span></code> parameter.</p>
<p>Parameters, which have not been set explicitly, will be set to default values,
which are defined inside the <code class="docutils literal notranslate"><span class="pre">kallithea</span></code> Puppet module. For example, if you
just stick to the defaults as in the <a class="reference internal" href="#simple-manifest"><span class="std std-ref">example above</span></a>,
you will end up with a Kallithea instance, which</p>
<ul class="simple">
<li>is installed in <code class="docutils literal notranslate"><span class="pre">/srv/kallithea</span></code>, owned by the user <code class="docutils literal notranslate"><span class="pre">kallithea</span></code></li>
<li>uses the Kallithea default configuration</li>
<li>uses the admin user <code class="docutils literal notranslate"><span class="pre">admin</span></code> with password <code class="docutils literal notranslate"><span class="pre">adminpw</span></code></li>
<li>is started automatically and enabled on boot</li>
</ul>
<p>As of Kallithea 0.3.0, this in particular means that Kallithea will use an
SQLite database and listen on <code class="docutils literal notranslate"><span class="pre">http://localhost:5000</span></code>.</p>
<p>See also the <a class="reference external" href="https://forge.puppetlabs.com/rauch/kallithea#class-kallithea">full parameters list</a> for more
information.</p>
</div>
<div class="section" id="making-your-kallithea-instance-publicly-available">
<h2>Making your Kallithea instance publicly available<a class="headerlink" href="#making-your-kallithea-instance-publicly-available" title="Permalink to this headline">¶</a></h2>
<p>If you followed the instructions above, the Kallithea instance will be
listening on <code class="docutils literal notranslate"><span class="pre">http://localhost:5000</span></code> and therefore not publicly available.
There are several ways to change this.</p>
<div class="section" id="the-direct-way">
<h3>The direct way<a class="headerlink" href="#the-direct-way" title="Permalink to this headline">¶</a></h3>
<p>The simplest setup is to instruct Kallithea to listen on another IP address
and/or port by using the <code class="docutils literal notranslate"><span class="pre">config_hash</span></code> parameter of the Kallithea Puppet
class. For example, assume we want to listen on all interfaces on port 80:</p>
<div class="highlight-puppet notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="p">{</span> <span class="s">&#39;kallithea&#39;</span><span class="p">:</span>
  <span class="na">seed_db</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
  <span class="na">config_hash</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s">&quot;server:main&quot;</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="s">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span>
      <span class="s">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;80&#39;</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="using-apache-as-reverse-proxy">
<h3>Using Apache as reverse proxy<a class="headerlink" href="#using-apache-as-reverse-proxy" title="Permalink to this headline">¶</a></h3>
<p>In a more advanced setup, you might instead want use a full-blown web server
like Apache HTTP Server as the public web server, configured such that requests
are internally forwarded to the local Kallithea instance (a so called <em>reverse
proxy setup</em>). This can be easily done with Puppet as well:</p>
<p>First, install the <a class="reference external" href="https://forge.puppetlabs.com/puppetlabs/apache">puppetlabs/apache</a> Puppet module as above by running the following as root:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>puppet module install puppetlabs/apache
</pre></div>
</div>
<p>Then, append the following to your manifest:</p>
<div class="highlight-puppet notranslate"><div class="highlight"><pre><span></span><span class="k">include</span> <span class="na">apache</span>

<span class="na">apache</span><span class="p">::</span><span class="na">vhost</span> <span class="p">{</span> <span class="s">&#39;kallithea.example.com&#39;</span><span class="p">:</span>
  <span class="na">docroot</span>             <span class="o">=&gt;</span> <span class="s">&#39;/var/www/html&#39;</span><span class="p">,</span>
  <span class="na">manage_docroot</span>      <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
  <span class="na">port</span>                <span class="o">=&gt;</span> <span class="mi">80</span><span class="p">,</span>
  <span class="na">proxy_preserve_host</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
  <span class="na">proxy_pass</span>          <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">path</span> <span class="o">=&gt;</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
      <span class="na">url</span>  <span class="o">=&gt;</span> <span class="s">&#39;http://localhost:5000/&#39;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Applying the resulting manifest will install the Apache web server and setup a
virtual host acting as a reverse proxy for your local Kallithea instance.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div style="text-align:center;margin:30px 0;">
  <img src="_static/kallithea-logo.svg" width="200px"/>
</div>
<h3>Support Kallithea development</h3>
<div style="text-align:center">
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="EYXFS3SQPHYUL">
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal &ndash; The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
    <div style="padding:5px">
     <a href="https://flattr.com/thing/922714/Donate-to-Software-Freedom-Conservancy" target="_blank">
     <img src="http://api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0" /></a>
    </div>
</div>

  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation and setup using Puppet</a><ul>
<li><a class="reference internal" href="#installing-puppet">Installing Puppet</a></li>
<li><a class="reference internal" href="#installing-the-puppet-module">Installing the Puppet module</a></li>
<li><a class="reference internal" href="#applying-the-module">Applying the module</a></li>
<li><a class="reference internal" href="#using-parameters-for-customizing-the-setup-process">Using parameters for customizing the setup process</a></li>
<li><a class="reference internal" href="#making-your-kallithea-instance-publicly-available">Making your Kallithea instance publicly available</a><ul>
<li><a class="reference internal" href="#the-direct-way">The direct way</a></li>
<li><a class="reference internal" href="#using-apache-as-reverse-proxy">Using Apache as reverse proxy</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="setup.html"
                        title="previous chapter">Setup</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="usage/general.html"
                        title="next chapter">General Kallithea usage</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/installation_puppet.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usage/general.html" title="General Kallithea usage"
             >next</a> |</li>
        <li class="right" >
          <a href="setup.html" title="Setup"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Kallithea 0.3.7 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2016 by various authors, licensed as GPLv3..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>