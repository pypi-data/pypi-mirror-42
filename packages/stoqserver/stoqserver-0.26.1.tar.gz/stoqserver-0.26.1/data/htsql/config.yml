tweak.override:
  field-labels:
    branch.description: (if(is_null(person.company.fancy_name), person.name, person.company.fancy_name))
    branch.main_address: (person.address.filter(is_main_address))
    sale.cmv: (sum(sale_item.total_cost))
    sale.discount_percentage: (if(subtotal > 0, (discount_value / subtotal), 0))
    sale.profit_margin: (if((cmv - returned_items_cost) > 0, ((total_amount / (cmv - returned_items_cost)) - 1) * 100, 0))
    sale.returned_items_cost: (sum(returned_sale_via_new_sale.returned_sale_item.sale_item.total_cost))
    sale.subtotal: (total_amount + discount_value - surcharge_value)
    sale.surcharge_percentage: (if(subtotal > 0, (surcharge_value / subtotal), 0))
    sale_item.price_with_discount: (total_price - sale_discount + sale_surcharge)
    sale_item.sale_discount: (total_price * sale.discount_percentage)
    sale_item.sale_surcharge: (total_price * sale.surcharge_percentage)
    sale_item.subtotal: (total_price * quantity)
    sale_item.total_cost: (quantity * if(average_cost > 0, average_cost, sellable.cost))
    sale_item.total_price: (price + ipi_info.v_ipi)
    sale_item.total_with_discount: (price_with_discount * quantity)
    sellable.price: (if (on_sale_start_date <= now() &now() <= on_sale_end_date, on_sale_price,base_price))
    transfer_order.branch: (source_branch)
  globals:
    between($date, $start, $end): ($date >= $start & $date <= $end)
    identifier_str: branch.acronym + head('0000', 5 - length(string(identifier))) + string(identifier)
    supplier_name: (if(is_null(nfe_supplier.name), nfe_supplier.fancy_name, nfe_supplier.name))
    trunc_day($d): datetime(year($d), month($d), day($d))
    trunc_hour($d): datetime(year($d), month($d), day($d), hour($d))
    trunc_month($d): datetime(year($d), month($d), 01)
