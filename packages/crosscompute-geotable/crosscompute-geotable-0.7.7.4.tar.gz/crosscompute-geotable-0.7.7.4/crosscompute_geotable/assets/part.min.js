function get_geotable_adjective(e){var a="streets|light|dark|satellite|streets-satellite|wheatpaste|streets-basic|comic|outdoors|run-bike-hike|pencil|pirates|emerald|high-contrast".replace(/-/g,"[-_]");try{return RegExp("("+a+")_geotable").exec(e)[1].replace(/_/g,"-")}catch(e){return"streets"}}function draw_map(e,a){for(var t=e+"-map",r=e+"-table",o=L.mapbox.map(t,"mapbox."+get_geotable_adjective(e)),i=[],l=a[0],d=a[1],c=0;c<l.length;c++){var s,n=l[c],p=n[0],u=n[1],_=2==p||5==p,b=$.extend({color:"black",weight:_?5:2,opacity:.7,fillColor:_?"#c9302c":"#286090",fillOpacity:.5},d,n[2]);switch(p){case 1:s=L.circleMarker(u,b),b.radius_in_pixels&&s.setRadius(+b.radius_in_pixels),add_feature(i,s,c,r);break;case 2:b.color=b.fillColor,add_feature(i,s=L.polyline(u,b),c,r);break;case 3:add_feature(i,s=L.polygon(u,b),c,r);break;case 4:for(var f=0;f<u.length;f++)s=L.circleMarker(u[f],b),b.radius_in_pixels&&s.setRadius(+b.radius_in_pixels),add_feature(i,s,c,r);break;case 5:b.color=b.fillColor;for(f=0;f<u.length;f++)add_feature(i,s=L.polyline(u[f],b),c,r);break;case 6:for(f=0;f<u.length;f++)add_feature(i,s=L.polygon(u[f],b),c,r)}}i.length&&o.fitBounds(L.featureGroup(i).addTo(o).getBounds(),{animate:!1}).on("click",function(){$("#"+r).hide()})}function add_feature(e,a,t,r){a.geotable={table_id:r,tbody_id:r.replace("-table","-row")+t},a.on("click",function(e){var a=this.geotable,t=$("#"+a.tbody_id).show();$("#"+a.table_id+" tbody").not(t).hide(),$("#"+a.table_id).show(),L.DomEvent.stopPropagation(e)}),e.push(a)}$(".geotable-upload").on("uploaded.ir",function(e,a){import_upload(e,a,CC.geotable.import_url,function(e,a){var t=a.find("script").text(),r=$.trim(t.replace(/'/g,'"').replace(/.* = /,"")).slice(0,-1);draw_map(a.attr("id"),$.parseJSON(r))})});
