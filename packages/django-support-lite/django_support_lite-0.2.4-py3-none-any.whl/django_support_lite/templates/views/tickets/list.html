{% extends DSL_LAYOUT_NAME %}

{% load static %}
{% load ticket %}

{% block django_support_lite_content %}
    <h5>
        List Tickets
    </h5>

    {% if perms.django_support_lite.can_manage %}
        <div>
            <span class="badge badge-primary">
                Tickets awaiting response: {{ count_awaiting }}
            </span>
        </div>
    {% endif %}

    <hr />

    {% if tickets %}
        <table class="table table-striped table-borderless">
            <thead>
                <tr>
                    <th style="width: 25%">
                        Labels
                    </th>

                    <th style="width: 25%">
                        Title
                    </th>

                    <th style="width: 20%">
                        User
                    </th>

                    <th style="width: 20%">
                        Date
                    </th>

                    <th style="width: 10%">
                        &nbsp;
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                    <tr>
                        <td>
                            <span class="badge badge-{{ ticket|ticket_state_css_class }}">
                                {{ ticket|ticket_state_label }}
                            </span>

                            {% if ticket.status == Status.OPEN and perms.django_support_lite.can_manage %}
                                <span class="badge badge-{{ ticket.priority|ticket_priority_css_class }}">
                                    {{ ticket.priority|ticket_priority_label }}
                                </span>
                            {% endif %}
                        </td>

                        <td>
                            <small>
                                {{ ticket.title }}
                            </small>
                        </td>

                        <td>
                            <small>
                                {{ ticket.user.username }}
                            </small>
                        </td>

                        <td>
                            <small>
                                {{ ticket.updated_at }}
                            </small>
                        </td>

                        <td class="text-right">
                            <a href="{% url 'django_support_lite:tickets.view' ticket.id %}" class="btn btn-sm btn-primary">
                                Ticket
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <hr />

        <nav>
            {% include 'partials/pagination.html' with pagination=pagination %}
        </nav>
    {% else %}
        {% include 'partials/stub.html' with text='No tickets.' %}
    {% endif %}
{% endblock %}
