{% extends "admin/base_site.html" %}
{% load i18n %}
{% load static %}

{% block breadcrumbs %}
    <div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
        &rsaquo; <a href="{% url 'admin:app_list' app_label='wrd' %}">WRD</a>
        &rsaquo; <a href="{% url 'admin:wrd_episode_changelist' %}">Episoden</a>
    {% if title %} &rsaquo; {{ title }}{% endif %}
    </div>
{% endblock %}

{% block content %}

    <div id="content-main">

        <ul class="object-tools">
            <li><a class="addlink" href="{% url 'admin:wrd_application_add' %}">Anmeldung hinzufügen</a></li>
        </ul>

        <table class="nowrap">
            <thead>
            <tr>
                <th>Name</th>
                <th>Kontakt</th>
                <th>Status</th>
                <th>DRSA/EH</th>
                {% for d in days %}
                    <th>{{ d|date:"D, d.m." }}</th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for a in episode.applications.all %}
                {% with dl=a.day_list %}
                    <tr class="{% cycle 'row1' 'row2' %}">
                        <td>
                            <a href="{{ a.get_admin_url }}">{{ a.user.name }}</a>
                        </td>
                    <td>
                        <a href="mailto:{{ a.user.email }}?subject={{ episode }}&body=Moin {{ a.user.get_short_name }}, ">📧</a>
                        {% if a.user.get_whatsapp_url %}
                        &nbsp;<a href="{{ a.user.get_whatsapp_url }}"><img width="16" src="{% static 'img/whatsapp.png' %}"></a>
                        {% endif %}
                    </td>
                        <td {% if a.comment %}title="{{ a.comment }}"{% endif %}>
                            <small>{{ a.get_application_status_display }}
                                {% if a.comment %}
                                    &nbsp;📝
                                {% endif %}
                            </small>
                        </td>
                        {% if a.eh_ok %}
                            {% if a.drsa_ok %}
                                <td title="Gültige DRSA- und EH-Nachweise liegen vor">📗</td>
                            {% else %}
                                <td title="DRSA-Nachweis fehlt, gültiger EH-Nachweis liegt vor">📒</td>
                            {% endif %}
                        {% else %}
                            {% if a.drsa_ok %}
                                <td title="Gültiger DRSA-Nachweis liegt vor, EH-Nachweis fehlt">📒</td>
                            {% else %}
                                <td title="DRSA- und EH-Nachweise liegen nicht vor">📕</td>
                            {% endif %}
                        {% endif %}
                        {% for d in days %}
                            <td>{% if d in dl %}
                                <span
                                        {% if a.application_status == 0 %}
                                            class="quiet"
                                        {% endif %}
                                >
                                {{ a.role }}
                                    </span>
                            {% else %}
                            {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endwith %}
                {% empty %}
                <tr>
                <td colspan="5"></td>
                <th colspan="{{ episode.days }}">
                    <span class="align-center">Es liegen keine Anmeldungen vor.</span>
                </th>
                </tr>
            {% endfor %}
            </tbody>
            <tfoot>
            <tr>
                <th colspan="4">Anzahl</th>
                {% for d in dayct %}
                    <th>{{ d.1 }}</th>
                {% endfor %}
            </tr>
            </tfoot>
        </table>

    </div>

{% endblock %}