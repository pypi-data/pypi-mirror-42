<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Igor Users</title>
	<style>
	table, th, td {
		border: 1px solid black;
		border-collapse: collapse;
	}
	</style>
</head>
<body>

	{% if not action or action == 'list' %}
		<h1>Igor Users</h1>
	
		{% set currentUser = igor.app.getSessionItem('user','') %}
		{% if currentUser %}
			<p>
				You are logged in as {{currentUser}}.
				{% if currentUser != 'admin' %}
					You may not have sufficient permissions for the commands below unless you login as user <i>admin</i>.
				{% endif %}
			</p>
		{% else %}
			<p>
				You are not logged in. This page will probably not render correctly.
			</p>
		{% endif %}
		
		<table style="width:100%">
			<tr>
				<th>Username</th>
				<th>Identity Entry</th>
				<th>People Entry</th>
				<th>Operation</th>
			</tr>
		
			{% set userList = igor.database.getElements('/data/identities/*', 'get', token) %}
			{% for user in userList %}
				{% if not ':' in user.tagName %}
					{% set username = user.tagName %}
					<tr>
						<td>{{username}}</td>
						<td><a href="/data/identities/{{username}}">identities/{{username}}</a></td>
						<td><a href="/data/people/{{username}}">people/{{username}}</a></td>
						<td>
							{% if username != 'admin' and username != currentUser %}
								<a href="/users.html?action=delete&username={{username}}">delete</a><br>
							{% endif %}
							<a href="/users.html?action=password&username={{username}}">change password</a>
						</td>
					</tr>
				{% endif %}
			{% endfor %}
		</table>
		
		<h1>Add User</h1>
		
		<p>To add a new user:</p>
		<form action="/plugin/user/add">
			<input name="returnTo" type="hidden" value="/users.html">
			Username: <input name="username"><br>
			Password: <input name="password" type="password"></br>
			<input type="submit" value="Add">
		</form>
		
	{% elif action == "delete" %}
		<h1>Delete User</h1>
		
		<p>Are you sure you want to delete user <b>{{username}}</b>? This action cannot be undone.</p>
		<form action="/plugin/user/delete">
			<input name="returnTo" type="hidden" value="/users.html">
			<input type="hidden" name="username" value="{{username}}"><br>
			<input type="submit" value="Delete">
		</form>
		
		<p><a href="/users.html">Return to user listing</a></p>

	{% elif action == "password" %}
		<h1>Change Password</h1>
		
		<p>Are you sure you want to change the password for user <b>{{username}}</b>? This action cannot be undone.</p>
		<form action="/plugin/user/password">
			<input name="returnTo" type="hidden" value="/users.html">
			<input type="hidden" name="username" value="{{username}}"><br>
			New password: <input name="password" type="password"></br>
			<input type="submit" value="Change Password">
		</form>
		
		<p><a href="/users.html">Return to user listing</a></p>
	{% else %}
		<p><em>Error</em> Unknown action {{action}}</p>
	{% endif %}
		

</body>
</html>
