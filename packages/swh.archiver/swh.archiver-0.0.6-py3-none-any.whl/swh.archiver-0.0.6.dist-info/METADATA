Metadata-Version: 2.1
Name: swh.archiver
Version: 0.0.6
Summary: Software Heritage archiver
Home-page: https://forge.softwareheritage.org/diffusion/DARC/
Author: Software Heritage developers
Author-email: swh-devel@inria.fr
License: UNKNOWN
Project-URL: Bug Reports, https://forge.softwareheritage.org/maniphest
Project-URL: Funding, https://www.softwareheritage.org/donate
Project-URL: Source, https://forge.softwareheritage.org/source/swh-archiver
Platform: UNKNOWN
Classifier: Programming Language :: Python :: 3
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
Classifier: Operating System :: OS Independent
Classifier: Development Status :: 5 - Production/Stable
Description-Content-Type: text/markdown
Requires-Dist: click
Requires-Dist: kafka-python
Requires-Dist: psycopg2
Requires-Dist: vcversioner
Requires-Dist: swh.core (>=0.0.54)
Requires-Dist: swh.journal (>=0.0.5)
Requires-Dist: swh.model (>=0.0.27)
Requires-Dist: swh.objstorage (>=0.0.17)
Requires-Dist: swh.scheduler (>=0.0.39)
Provides-Extra: testing
Requires-Dist: pytest (<4) ; extra == 'testing'
Requires-Dist: pytest-postgresql ; extra == 'testing'

swh-archiver
============

Orchestrator in charge of guaranteeing that object storage content is pristine
and available in a sufficient amount of copies.

Tests
-----

This module's tests need a postgres db to run. It is recommended to run 
those but they can be skipped:

- `make test`:      will run all tests
- `make test-nodb`: will run only tests that do not need a local DB
- `make test-db`:   will run only tests that do need a local DB

If you do want to run DB-related tests, you should ensure you have access with
sufficient privileges to a Postgresql database.

### Using your system database

You need to:

- ensure that your user is authorized to create and drop DBs, and in particular
  DBs named "softwareheritage-test" and "softwareheritage-dev"

- ensure that you have the storage testdata repository checked out in
  ../swh-storage-testdata

### Using pifpaf

[pifpaf](https://github.com/jd/pifpaf) is a suite of fixtures and a
command-line tool that allows to start and stop daemons for a quick throw-away
usage.

It can be used to run tests that need a Postgres database without any other
configuration reauired nor the need to have special access to a running
database:

```bash

$ pifpaf run postgresql make test-db
[snip]
----------------------------------------------------------------------
Ran 12 tests in 0.903s

OK
```

Note that pifpaf is not yet available as a Debian package, so you may have to
install it in a venv.


